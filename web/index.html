<!DOCTYPE html>
<html>
  <head>
    <base href="/" />

    <meta charset="UTF-8" />
    <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
    <meta name="description" content="가스 모니터링 시스템" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- iOS meta tags & icons -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="가스 모니터링" />
    <link rel="apple-touch-icon" href="icons/Icon-192.png" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png" />

    <title>가스 모니터링 시스템</title>
    <link rel="manifest" href="manifest.json" />

    <style>
      /* 로컬 폰트 정의 (외부 Google Fonts 대신 사용) */
      @font-face {
        font-family: "NotoSansKR";
        font-style: normal;
        font-weight: 400;
        src: url("fonts/NotoSansKR-Regular.ttf") format("ttf"),
          local("Malgun Gothic"), local("맑은 고딕"), local("Segoe UI"),
          local("Arial");
        font-display: swap;
      }
      @font-face {
        font-family: "Roboto";
        font-style: normal;
        font-weight: 400;
        src: url("fonts/Roboto-Regular.ttf") format("ttf"), local("Segoe UI"),
          local("Arial"), local("sans-serif");
        font-display: swap;
      }

      body {
        margin: 0;
        padding: 0;
        background: #f5f5f5;
        /* 로컬 폰트 우선 사용, fallback으로 시스템 폰트 */
        font-family: "NotoSansKR", "Roboto", "Segoe UI", "맑은 고딕",
          "Malgun Gothic", Tahoma, Arial, sans-serif;
      }
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        flex-direction: column;
      }
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 2s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="loading">
      <div class="spinner"></div>
      <p>가스 모니터링 시스템 로딩중...</p>
    </div>

    <!-- 외부 폰트 로딩 차단 및 로컬 폰트 강제 -->
    <script>
      // Flutter 설정: 로컬 폰트 사용
      window.flutterConfiguration = {
        renderer: "html",
        canvasKitBaseUrl: null,
        fontFallbacks: ["NotoSansKR", "Roboto", "Segoe UI", "Arial"],
        useColorEmoji: false,
      };

      // 모든 외부 폰트 요청 차단
      (function () {
        "use strict";

        const originalFetch = window.fetch;
        const originalXMLHttpRequest = window.XMLHttpRequest;

        // Fetch API 차단
        window.fetch = function (resource, options) {
          const url = typeof resource === "string" ? resource : resource.url;

          // 외부 폰트 요청 차단
          if (
            url &&
            (url.includes("gstatic.com") ||
              url.includes("googleapis.com") ||
              url.includes("fonts.") ||
              (url.startsWith("http") &&
                !url.includes("localhost") &&
                !url.includes("192.168.")))
          ) {
            console.warn("외부 폰트 요청 차단:", url);
            return Promise.reject(new Error("외부 요청 차단: " + url));
          }

          return originalFetch.call(this, resource, options);
        };

        // XMLHttpRequest 차단
        window.XMLHttpRequest = function () {
          const xhr = new originalXMLHttpRequest();
          const originalOpen = xhr.open;

          xhr.open = function (method, url, ...args) {
            if (
              url &&
              (url.includes("gstatic.com") ||
                url.includes("googleapis.com") ||
                url.includes("fonts."))
            ) {
              console.warn("외부 폰트 XHR 요청 차단:", url);
              throw new Error("외부 XHR 요청 차단: " + url);
            }
            return originalOpen.call(this, method, url, ...args);
          };

          return xhr;
        };

        // CSS @font-face 동적 생성 차단
        const originalInsertRule = CSSStyleSheet.prototype.insertRule;
        CSSStyleSheet.prototype.insertRule = function (rule, index) {
          if (
            rule &&
            (rule.includes("gstatic.com") ||
              rule.includes("googleapis.com") ||
              rule.includes("fonts."))
          ) {
            console.warn("외부 폰트 CSS 규칙 차단:", rule);
            return index || 0;
          }
          return originalInsertRule.call(this, rule, index);
        };
      })();
    </script>

    <script src="flutter_bootstrap.js" async></script>
  </body>
</html>
